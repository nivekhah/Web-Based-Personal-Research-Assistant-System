<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>创建主页-上传头像</title>
    <link rel="stylesheet" href="/static/css/style.css" type="text/css" />
    <!--<link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="../static/bootstrap.min.css">
    <script src="../static/jquery-3.2.1.slim.min.js"></script>
    <script src="../static/bootstrap.min.js"></script>
</head>
<body>

    <script type="text/javascript" src="/static/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/static/js/cropbox.js"></script>

<div id="main_div">
    <div id="menu" style="height: 5%;width: 100%;background-color: #0099cc" >

    </div>
    <div id="choose" style="height: 20%;width: 100%;background-color: #ffffff">
        <div class="col-xs-2" style="height: 100%">
        </div>
        <div class="col-xs-8" style="height: 100%">
            <div class="col-xs-2" style="height: 100%;top: 45%">
                <span >3.上传头像</span>
            </div>
            <div class="col-xs-2" style="height: 100%;top: 40%">
                <div id="circle1" style="background-color:#dbe2ed; border-radius:25px;border: 1px #b3b8c2 solid" >
                </div>
            </div>
            <div class="col-xs-2" style="height: 100%;top: 40%">
                <div id="circle2" style="background-color:#dbe2ed; border-radius:25px;border: 1px #b3b8c2 solid" >
                </div>
            </div>
            <div class="col-xs-2" style="height: 100%;top: 40%">
               <div id="circle3" style="background-color:#edf4ff; border-radius:25px;border: 3px red solid" >
                </div>
            </div>
            <div class="col-xs-2" style="height: 100%;top: 40%">
                <div id="circle4" style="background-color:#dbe2ed; border-radius:25px;border: 1px #b3b8c2 solid">
                </div>
            </div>
            <div class="col-xs-2" style="height: 100%;top: 40%">
                <div id="circle5" style="background-color:#dbe2ed; border-radius:25px;border: 1px #b3b8c2 solid">
                </div>
            </div>
        </div>
        <div class="col-xs-2" style="height: 100%"></div>
    </div>
    <div style="height: 60%;width: 100%;">
        <div class="col-xs-2" style="height: 100%"></div>
        <div class="col-xs-8" style="height: 100%;border: 1px #b3b8c2 solid">
            <div style="height: 25%;width: 100%;border-bottom: 1px solid #eee;">
                <div class="col-xs-2" style="height: 100%;"></div>
                <div class="col-xs-10" style="height: 100%;" >
                    <div style="height: 30%"></div>
                    <span style="font-size: 30px;font-weight: bold">上传头像</span>
                </div>
            </div>
            <div style="height: 53%;">
                <div style="height: 15%;width: 100%"></div>
                <div class="col-xs-6" style="height: 60%;text-align: center">
                    <img id="pic" style="height: 150px;width:150px" src="../static/timg.jpeg">
                </div>
                <!--<div class="col-xs-4" style="height: 60%">

                </div>-->
                <div class="col-xs-6" style="height: 60%;">
                    <div style="height: 50%"></div>
                    <input class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" type="button" value="选择照片" style="height: 30%;width: 50%;background-color: #0099cc;border: 0;border-radius: 3px;box-shadow: 0 1px 4px 0 rgba(12, 12, 13, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.15);">
                </div>
                <div style="height: 20%;width: 100%"></div>
            </div>
            <div style="height: 17%">
                <div style="height: 20%;width: 100%"></div>
                <div class="col-xs-6" style="height: 60%">
                    <div class="col-xs-6" style="height: 100%">
                        <input style="height: 100%;width: 100%;;background-color: #0099cc;border: 0;border-radius: 3px;box-shadow: 0 1px 4px 0 rgba(12, 12, 13, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.15);" type="button" value="上一步" onclick="before()">
                    </div>
                    <div class="col-xs-6" style="height: 100%">
                        <input style="height: 100%;width: 100%;;background-color: #0099cc;border: 0;border-radius: 3px;box-shadow: 0 1px 4px 0 rgba(12, 12, 13, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.15);" type="button" value="下一步" onclick="next()">
                    </div>
                </div>
                <div class="col-xs-6" style="height: 60%;top: 15%">
                </div>
                <div style="height: 20%;width: 100%"></div>

            </div>
        </div>
        <div class="col-xs-2" style="height: 100%"></div>
    </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">选择头像</h4>
            </div>
            <div class="modal-body">
                <div class="imageBox">
                    <div class="thumbBox">
                    </div>
                    <div class="spinner" style="display: none">Loading...
                    </div>
                </div>

                <div class="cropped">
                </div>
            </div>
            <div class="modal-footer">
                <div class="action">
                <!-- <input type="file" id="file" style=" width: 200px">-->
                    <div class="new-contentarea tc">
                        <a href="javascript:void(0)" class="upload-img">
                            <label for="upload-file">选择图像</label>
                        </a>
                        <input type="file" class="" name="upload-file" id="upload-file" />
                    </div>
                    <input type="button" id="btnSubmit" class="Btnsty_peyton" value="上传" data-dismiss="modal"/>
                    <input type="button" id="btnCrop" class="Btnsty_peyton" value="裁切" />
                    <input type="button" id="btnZoomIn" class="Btnsty_peyton" value="+" />
                    <input type="button" id="btnZoomOut" class="Btnsty_peyton" value="-" />
                </div>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<script type="text/javascript">
    $(document).ready(function(){
        function setHeight(){
            var windowHeight = document.documentElement.clientHeight;
            var windowWidth = document.documentElement.clientWidth;
            $('#main_div').css('height',1*windowHeight + "px");
            $('#main_div').css('width',windowWidth+ "px");
            $('#circle1').css('height',0.05*windowHeight + "px");
            $('#circle1').css('width',0.05*windowHeight+ "px");
            $('#circle2').css('height',0.05*windowHeight + "px");
            $('#circle2').css('width',0.05*windowHeight+ "px");
            $('#circle3').css('height',0.05*windowHeight + "px");
            $('#circle3').css('width',0.05*windowHeight+ "px");
            $('#circle4').css('height',0.05*windowHeight + "px");
            $('#circle4').css('width',0.05*windowHeight+ "px");
            $('#circle5').css('height',0.05*windowHeight + "px");
            $('#circle5').css('width',0.05*windowHeight+ "px");
        }
        setHeight();
        $(window).resize(function() {
            setHeight();
        });
	});
    //点击下一步，先将首页的数据提交到后台，然后进行页面的跳转，点击上一步，可以跳转到前一面进行信息修改
    function before() {
        //跳转到页面二
        window.location.href='pagetwo';
    }
    function next() {
        //跳转到页面四
        window.location.href='pagefour';
    }

    $(window).load(function () {
        var options = {
            thumbBox: '.thumbBox',
            spinner: '.spinner',
            imgSrc: '/static/images/avatar.png'
        }

        var cropper = $('.imageBox').cropbox(options);
            $('#upload-file').on('change', function () {
                var reader = new FileReader();
                reader.onload = function (e) {
                    options.imgSrc = e.target.result;
                    cropper = $('.imageBox').cropbox(options);
                }
                reader.readAsDataURL(this.files[0]);
                this.files = [];
            })
            $('div.imageBox').bind('mousewheel DOMMouseScroll', reset);
            $('#btnCrop').on('click', function () {
                var img = cropper.getDataURL();
                $('.cropped').html('');
                $('.cropped').append('<img src="' + img + '" align="absmiddle" style="width:64px;margin-top:4px;border-radius:64px;box-shadow:0px 0px 12px #7E7E7E;" ><p>64px*64px</p>');
                $('.cropped').append('<img src="' + img + '" align="absmiddle" style="width:128px;margin-top:4px;border-radius:128px;box-shadow:0px 0px 12px #7E7E7E;"><p>128px*128px</p>');
                $('.cropped').append('<img src="' + img + '" align="absmiddle" style="width:180px;margin-top:4px;border-radius:180px;box-shadow:0px 0px 12px #7E7E7E;"><p>180px*180px</p>');

            })
            $('#btnZoomIn').on('click', function () {
                cropper.zoomIn();
                reset();
            })
            $('#btnZoomOut').on('click', function () {
                cropper.zoomOut();
                reset();
            })
            $('#btnSubmit').on('click', function () {
                //alert('dddd')
                $('#circularG').show();
                var img = cropper.getDataURL().replace('data:image/png;base64,', '');
                var url = '/upload/';
                var data = {
                    action: "add",
                    picStr: img
                };
                $.ajax(url, {
                    type: 'post',
                    data: data,
                    success: function (data) {
                        $('#circularG').hide();
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {

                    }
                });
                var username="{{ username }}";
                document.getElementById("pic").src="../static/pic/"+username+"/test.png";
                //$('#myModal').modal('hide');
            })
            $('#btnGetAvatar').on('click', function () {
                var url = '/upload/';
                var data = {
                    action: "get"
                };
                $.ajax(url, {
                    type: 'post',
                    data: data,
                    success: function (data) {
                        $("#avatarimg").append('<img src="data:image/png;base64,' + data + '" align="absmiddle" style="width:64px;margin-top:4px;border-radius:64px;box-shadow:0px 0px 12px #7E7E7E;" ><p>64px*64px</p>');
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {

                    }
                });
            })

            function reset() {
                //console.log('aaaa');
                var img = cropper.getDataURL();
                $('.cropped').html('');
                $('.cropped').append('<img src="' + img + '" align="absmiddle" style="width:64px;margin-top:4px;border-radius:64px;box-shadow:0px 0px 12px #7E7E7E;" ><p>64px*64px</p>');
                $('.cropped').append('<img src="' + img + '" align="absmiddle" style="width:128px;margin-top:4px;border-radius:128px;box-shadow:0px 0px 12px #7E7E7E;"><p>128px*128px</p>');
                $('.cropped').append('<img src="' + img + '" align="absmiddle" style="width:180px;margin-top:4px;border-radius:180px;box-shadow:0px 0px 12px #7E7E7E;"><p>180px*180px</p>');

            }
        });


</script>
</body>
</html>